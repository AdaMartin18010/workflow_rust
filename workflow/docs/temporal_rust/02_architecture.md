# æ¶æ„è®¾è®¡

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°åŸºäºTemporalçš„Rust 1.90å·¥ä½œæµç³»ç»Ÿçš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š

- ç³»ç»Ÿæ•´ä½“æ¶æ„
- åˆ†å±‚è®¾è®¡
- æ ¸å¿ƒç»„ä»¶
- æ•°æ®æµ
- éƒ¨ç½²æ¨¡å¼
- ä¸Temporal Serverçš„å…³ç³»

---

## ğŸ—ï¸ ç³»ç»Ÿæ•´ä½“æ¶æ„

### æ¶æ„å…¨æ™¯å›¾

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Temporal-Rust å·¥ä½œæµç³»ç»Ÿæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      åº”ç”¨å±‚ (Application Layer)                  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  #[workflow] â”‚  â”‚  #[activity] â”‚  â”‚    Signal    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   Workflow   â”‚  â”‚   Activity   â”‚  â”‚    Query     â”‚           â”‚   â”‚
â”‚  â”‚  â”‚  Definitions â”‚  â”‚  Definitions â”‚  â”‚  Handlers    â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                         â”‚
â”‚                              â”‚ ä½¿ç”¨                                    â”‚
â”‚                              â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      SDKå±‚ (SDK Layer)                          â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ WorkflowContext â”‚              â”‚ ActivityContext â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   å·¥ä½œæµä¸Šä¸‹æ–‡   â”‚              â”‚   æ´»åŠ¨ä¸Šä¸‹æ–‡     â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ WorkflowClient  â”‚              â”‚ WorkflowWorker  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   å·¥ä½œæµå®¢æˆ·ç«¯   â”‚              â”‚   å·¥ä½œæµæ‰§è¡Œå™¨   â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                           â”‚
â”‚                              â”‚ ä¾èµ–                                      â”‚
â”‚                              â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      è¿è¡Œæ—¶å±‚ (Runtime Layer)                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  Task Poller    â”‚              â”‚ Event Processor â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   ä»»åŠ¡è½®è¯¢å™¨     â”‚              â”‚   äº‹ä»¶å¤„ç†å™¨     â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ Signal Registry â”‚              â”‚ Query Registry  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   ä¿¡å·æ³¨å†Œè¡¨     â”‚              â”‚   æŸ¥è¯¢æ³¨å†Œè¡¨     â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  Tokio Runtime  â”‚              â”‚  Connection Poolâ”‚           â”‚   â”‚
â”‚  â”‚  â”‚   å¼‚æ­¥è¿è¡Œæ—¶     â”‚              â”‚   è¿æ¥æ±          â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                           â”‚
â”‚                              â”‚ ä½¿ç”¨                                      â”‚
â”‚                              â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      é€šä¿¡å±‚ (Communication Layer)                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚  gRPC Client    â”‚              â”‚ Protocol Buffersâ”‚           â”‚   â”‚
â”‚  â”‚  â”‚  (tonic)        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  (prost)        â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â–²                                           â”‚
â”‚                              â”‚ ä¸Temporal Serveré€šä¿¡                    â”‚
â”‚                              â”‚                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æŒä¹…åŒ–å±‚ (Persistence Layer)                 â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ WorkflowStorage â”‚              â”‚  Event History  â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   Trait         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   äº‹ä»¶å†å²       â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚           â–²                                                       â”‚   â”‚
â”‚  â”‚           â”‚ å®ç°                                                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚            â”‚            â”‚                  â”‚   â”‚
â”‚  â”‚  â–¼                 â–¼            â–¼            â–¼                  â”‚   â”‚
â”‚  â”‚ PostgreSQL       MySQL       Memory      Temporal Server         â”‚   â”‚
â”‚  â”‚ Storage         Storage      Storage      (å¯é€‰)                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      å¯è§‚æµ‹å±‚ (Observability Layer)               â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚    Tracing      â”‚  â”‚     Metrics     â”‚  â”‚     Logging     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  åˆ†å¸ƒå¼è¿½è¸ª      â”‚  â”‚    æŒ‡æ ‡æ”¶é›†      â”‚  â”‚    æ—¥å¿—è®°å½•      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡åŸåˆ™

1. **Temporalå…¼å®¹æ€§**: å®Œå…¨éµå¾ªTemporalçš„è®¾è®¡æ¨¡å¼å’Œæ¦‚å¿µæ¨¡å‹
2. **æ¨¡å—åŒ–**: æ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†ï¼ŒèŒè´£åˆ†ç¦»
3. **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œé›†æˆ
4. **ç±»å‹å®‰å…¨**: å……åˆ†åˆ©ç”¨Rustçš„ç±»å‹ç³»ç»Ÿ
5. **æ€§èƒ½ä¼˜å…ˆ**: é›¶æˆæœ¬æŠ½è±¡ï¼Œæœ€å°åŒ–è¿è¡Œæ—¶å¼€é”€
6. **å¯è§‚æµ‹æ€§**: å†…ç½®ç›‘æ§ã€è¿½è¸ªå’Œæ—¥å¿—

---

## ğŸ“ åˆ†å±‚æ¶æ„è¯¦è§£

### 1. åº”ç”¨å±‚ (Application Layer)

**èŒè´£**: ä¸šåŠ¡é€»è¾‘å®šä¹‰

**æ ¸å¿ƒç»„ä»¶**:

```rust
// å·¥ä½œæµå®šä¹‰
#[workflow]
pub async fn business_workflow(
    ctx: WorkflowContext,
    input: BusinessInput,
) -> Result<BusinessOutput, WorkflowError> {
    // ä¸šåŠ¡é€»è¾‘
}

// Activityå®šä¹‰
#[activity]
pub async fn business_activity(
    ctx: ActivityContext,
    input: ActivityInput,
) -> Result<ActivityOutput, ActivityError> {
    // å…·ä½“æ“ä½œ
}
```

**ç‰¹ç‚¹**:

- å£°æ˜å¼API
- ç±»å‹å®‰å…¨
- å®ç®€åŒ–å®šä¹‰
- ä¸Temporal Go SDKé£æ ¼ä¸€è‡´

### 2. SDKå±‚ (SDK Layer)

**èŒè´£**: æä¾›å·¥ä½œæµå¼€å‘API

**æ ¸å¿ƒç»„ä»¶**:

#### 2.1 WorkflowContext

```rust
pub struct WorkflowContext {
    workflow_id: WorkflowId,
    run_id: RunId,
    workflow_type: String,
    task_queue: String,
    history: Arc<RwLock<EventHistory>>,
    signals: Arc<SignalRegistry>,
    queries: Arc<QueryRegistry>,
}

impl WorkflowContext {
    /// æ‰§è¡ŒActivity
    pub async fn execute_activity<A: Activity>(
        &self,
        input: A::Input,
        options: ActivityOptions,
    ) -> Result<A::Output, WorkflowError>;
    
    /// ç­‰å¾…Signal
    pub async fn await_signal<S: Signal>(&self) -> Result<S, WorkflowError>;
    
    /// æ³¨å†ŒQueryå¤„ç†å™¨
    pub fn set_query_handler<Q: Query, F>(&self, handler: F);
    
    /// å®šæ—¶å™¨
    pub async fn sleep(&self, duration: Duration);
    
    /// å¯åŠ¨å­å·¥ä½œæµ
    pub async fn start_child_workflow<W: Workflow>(
        &self,
        input: W::Input,
        options: ChildWorkflowOptions,
    ) -> Result<ChildWorkflowHandle<W::Output>, WorkflowError>;
}
```

#### 2.2 WorkflowClient

```rust
pub struct WorkflowClient {
    storage: Arc<dyn WorkflowStorage>,
    grpc_client: Option<Arc<TemporalGrpcClient>>,
    task_dispatcher: Arc<TaskDispatcher>,
}

impl WorkflowClient {
    /// å¯åŠ¨å·¥ä½œæµ
    pub async fn start_workflow<W: Workflow>(
        &self,
        workflow_id: WorkflowId,
        task_queue: String,
        input: W::Input,
        options: StartWorkflowOptions,
    ) -> Result<WorkflowHandle<W::Output>, ClientError>;
    
    /// å‘é€Signal
    pub async fn signal_workflow<S: Signal>(
        &self,
        workflow_id: &WorkflowId,
        signal: S,
    ) -> Result<(), ClientError>;
    
    /// æŸ¥è¯¢å·¥ä½œæµ
    pub async fn query_workflow<Q: Query>(
        &self,
        workflow_id: &WorkflowId,
    ) -> Result<Q::Result, ClientError>;
}
```

#### 2.3 WorkflowWorker

```rust
pub struct WorkflowWorker {
    config: WorkerConfig,
    task_queue: String,
    workflows: Arc<RwLock<HashMap<String, WorkflowFactory>>>,
    activities: Arc<RwLock<HashMap<String, ActivityFactory>>>,
    storage: Arc<dyn WorkflowStorage>,
    task_poller: Arc<TaskPoller>,
}

impl WorkflowWorker {
    /// æ³¨å†Œå·¥ä½œæµ
    pub fn register_workflow<W: Workflow>(&mut self);
    
    /// æ³¨å†ŒActivity
    pub fn register_activity<A: Activity>(&mut self);
    
    /// å¯åŠ¨Worker
    pub async fn start(self: Arc<Self>) -> Result<(), WorkerError>;
}
```

### 3. è¿è¡Œæ—¶å±‚ (Runtime Layer)

**èŒè´£**: ä»»åŠ¡è°ƒåº¦å’Œäº‹ä»¶å¤„ç†

**æ ¸å¿ƒç»„ä»¶**:

#### 3.1 TaskPoller

```rust
pub struct TaskPoller {
    task_queue: String,
    storage: Arc<dyn WorkflowStorage>,
    max_concurrent_tasks: usize,
}

impl TaskPoller {
    /// è½®è¯¢å·¥ä½œæµä»»åŠ¡
    pub async fn poll_workflow_tasks(&self) -> Result<Option<WorkflowTask>, PollError>;
    
    /// è½®è¯¢Activityä»»åŠ¡
    pub async fn poll_activity_tasks(&self) -> Result<Option<ActivityTask>, PollError>;
}
```

#### 3.2 EventProcessor

```rust
pub struct EventProcessor {
    storage: Arc<dyn WorkflowStorage>,
}

impl EventProcessor {
    /// å¤„ç†å·¥ä½œæµäº‹ä»¶
    pub async fn process_workflow_event(
        &self,
        event: WorkflowEvent,
    ) -> Result<(), ProcessError>;
    
    /// é‡æ”¾äº‹ä»¶å†å²
    pub async fn replay_history(
        &self,
        workflow_id: &WorkflowId,
    ) -> Result<WorkflowState, ProcessError>;
}
```

#### 3.3 SignalRegistry å’Œ QueryRegistry

```rust
pub struct SignalRegistry {
    handlers: Arc<RwLock<HashMap<String, SignalHandler>>>,
    pending: Arc<RwLock<HashMap<String, VecDeque<Value>>>>,
}

pub struct QueryRegistry {
    handlers: Arc<RwLock<HashMap<String, QueryHandler>>>,
}
```

### 4. é€šä¿¡å±‚ (Communication Layer)

**èŒè´£**: ä¸Temporal Serveré€šä¿¡

**æ ¸å¿ƒç»„ä»¶**:

#### 4.1 TemporalGrpcClient

```rust
pub struct TemporalGrpcClient {
    workflow_service: WorkflowServiceClient<Channel>,
}

impl TemporalGrpcClient {
    /// å¯åŠ¨å·¥ä½œæµæ‰§è¡Œ
    pub async fn start_workflow_execution(
        &self,
        request: StartWorkflowExecutionRequest,
    ) -> Result<StartWorkflowExecutionResponse, tonic::Status>;
    
    /// è½®è¯¢å·¥ä½œæµä»»åŠ¡
    pub async fn poll_workflow_task_queue(
        &self,
        request: PollWorkflowTaskQueueRequest,
    ) -> Result<PollWorkflowTaskQueueResponse, tonic::Status>;
    
    /// å®Œæˆå·¥ä½œæµä»»åŠ¡
    pub async fn respond_workflow_task_completed(
        &self,
        request: RespondWorkflowTaskCompletedRequest,
    ) -> Result<RespondWorkflowTaskCompletedResponse, tonic::Status>;
}
```

### 5. æŒä¹…åŒ–å±‚ (Persistence Layer)

**èŒè´£**: çŠ¶æ€æŒä¹…åŒ–å’Œäº‹ä»¶å­˜å‚¨

**æ ¸å¿ƒæŠ½è±¡**:

#### 5.1 WorkflowStorage Trait

```rust
#[async_trait]
pub trait WorkflowStorage: Send + Sync {
    /// ä¿å­˜å·¥ä½œæµæ‰§è¡Œ
    async fn save_workflow_execution(
        &self,
        execution: &WorkflowExecution,
        history: &EventHistory,
    ) -> Result<(), StorageError>;
    
    /// åŠ è½½å·¥ä½œæµæ‰§è¡Œ
    async fn load_workflow_execution(
        &self,
        workflow_id: &WorkflowId,
    ) -> Result<(WorkflowExecution, EventHistory), StorageError>;
    
    /// è¿½åŠ äº‹ä»¶
    async fn append_event(
        &self,
        workflow_id: &WorkflowId,
        event: WorkflowEvent,
    ) -> Result<EventId, StorageError>;
    
    /// è·å–äº‹ä»¶å†å²
    async fn get_event_history(
        &self,
        workflow_id: &WorkflowId,
        from_event_id: Option<EventId>,
    ) -> Result<Vec<WorkflowEvent>, StorageError>;
}
```

#### 5.2 å®ç°

- **PostgresWorkflowStorage**: PostgreSQLå®ç°
- **MySQLWorkflowStorage**: MySQLå®ç°
- **InMemoryWorkflowStorage**: å†…å­˜å®ç°ï¼ˆæµ‹è¯•ç”¨ï¼‰

### 6. å¯è§‚æµ‹å±‚ (Observability Layer)

**èŒè´£**: ç›‘æ§ã€è¿½è¸ªå’Œæ—¥å¿—

**ç»„ä»¶**:

- **Tracing**: ä½¿ç”¨`tracing` crateå®ç°ç»“æ„åŒ–æ—¥å¿—
- **Metrics**: ä½¿ç”¨`metrics` crateæ”¶é›†æ€§èƒ½æŒ‡æ ‡
- **OpenTelemetry**: åˆ†å¸ƒå¼è¿½è¸ª

---

## ğŸ”„ æ•°æ®æµå›¾

### å·¥ä½œæµå¯åŠ¨æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. start_workflow()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowClient          â”‚
â”‚  - åˆ›å»º WorkflowExecution   â”‚
â”‚  - è®°å½• Started äº‹ä»¶        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. ä¿å­˜åˆ°å­˜å‚¨
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowStorage         â”‚
â”‚  - ä¿å­˜æ‰§è¡Œè®°å½•             â”‚
â”‚  - ä¿å­˜äº‹ä»¶å†å²             â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. åˆ†å‘ä»»åŠ¡
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     TaskQueue               â”‚
â”‚  - ä»»åŠ¡å…¥é˜Ÿ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Workerè½®è¯¢
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowWorker          â”‚
â”‚  - è½®è¯¢ä»»åŠ¡é˜Ÿåˆ—             â”‚
â”‚  - è·å–å·¥ä½œæµä»»åŠ¡           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. æ‰§è¡Œå·¥ä½œæµ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowContext         â”‚
â”‚  - åˆ›å»ºæ‰§è¡Œç¯å¢ƒ             â”‚
â”‚  - æ‰§è¡Œå·¥ä½œæµå‡½æ•°           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. æ‰§è¡ŒActivities
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ActivityContext         â”‚
â”‚  - æ‰§è¡ŒActivityå‡½æ•°         â”‚
â”‚  - è®°å½•Activityäº‹ä»¶         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. å®Œæˆ/å¤±è´¥
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     EventProcessor          â”‚
â”‚  - å¤„ç†å®Œæˆäº‹ä»¶             â”‚
â”‚  - æ›´æ–°çŠ¶æ€                 â”‚
â”‚  - æŒä¹…åŒ–ç»“æœ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Signalå¤„ç†æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. signal_workflow()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowClient          â”‚
â”‚  - åˆ›å»º Signal äº‹ä»¶         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. è®°å½•äº‹ä»¶
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowStorage         â”‚
â”‚  - ä¿å­˜ Signal äº‹ä»¶         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. é€šçŸ¥Worker
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SignalRegistry          â”‚
â”‚  - æŸ¥æ‰¾Signalå¤„ç†å™¨         â”‚
â”‚  - è§¦å‘å¤„ç†å™¨               â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. å”¤é†’å·¥ä½œæµ
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowContext         â”‚
â”‚  - await_signal() è¿”å›      â”‚
â”‚  - ç»§ç»­æ‰§è¡Œå·¥ä½œæµ           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Queryå¤„ç†æµç¨‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. query_workflow()
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     WorkflowClient          â”‚
â”‚  - åˆ›å»º Query è¯·æ±‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. è·¯ç”±åˆ°Worker
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     QueryRegistry           â”‚
â”‚  - æŸ¥æ‰¾Queryå¤„ç†å™¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. æ‰§è¡Œå¤„ç†å™¨
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Query Handler           â”‚
â”‚  - è¯»å–å·¥ä½œæµçŠ¶æ€           â”‚
â”‚  - è¿”å›ç»“æœ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. è¿”å›ç»™Client
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  - è·å–ç»“æœ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ éƒ¨ç½²æ¶æ„

### å•æœºéƒ¨ç½²æ¨¡å¼

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       å•æœºéƒ¨ç½²                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Application Process                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚ WorkflowClient â”‚        â”‚ WorkflowWorker â”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚          In-Memory Storage (å¼€å‘/æµ‹è¯•)         â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**:

- ç®€å•éƒ¨ç½²
- é€‚åˆå¼€å‘å’Œæµ‹è¯•
- æ— å¤–éƒ¨ä¾èµ–

### ç‹¬ç«‹éƒ¨ç½²æ¨¡å¼

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç‹¬ç«‹éƒ¨ç½²                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  Client Process  â”‚          â”‚  Worker Process  â”‚                â”‚
â”‚  â”‚                  â”‚          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                â”‚
â”‚  â”‚ WorkflowClient   â”‚          â”‚  â”‚   Worker   â”‚  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                â”‚
â”‚            â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚            â”‚                            â”‚                            â”‚
â”‚            â”‚                            â”‚                            â”‚
â”‚            â–¼                            â–¼                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚            PostgreSQL / MySQL                     â”‚              â”‚
â”‚  â”‚         (WorkflowStorage Implementation)          â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**:

- Clientå’ŒWorkeråˆ†ç¦»
- ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“
- æ”¯æŒå¤šWorkerå®ä¾‹
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

### ä¸Temporal Serveré›†æˆ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸ Temporal Server é›†æˆ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  Client Process  â”‚                    â”‚  Worker Process  â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚  â”‚  â”‚WorkflowClientâ”‚ gRPC               â”‚  â”‚   Worker   â”‚  â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                â”‚                     â–²                   â”‚
â”‚                                â–¼                     â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚  â”‚            Temporal Server (gRPC API)          â”‚ â”‚ gRPC              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚                   â”‚
â”‚  â”‚  â”‚   Frontend   â”‚  â”‚    History   â”‚           â”‚â”€â”˜                   â”‚
â”‚  â”‚  â”‚   Service    â”‚  â”‚    Service   â”‚           â”‚                     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                           â”‚                                              â”‚
â”‚                           â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚         Temporal Server Database               â”‚                     â”‚
â”‚  â”‚      (Cassandra / PostgreSQL / MySQL)          â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‰¹ç‚¹**:

- å®Œå…¨å…¼å®¹Temporalç”Ÿæ€
- ä½¿ç”¨Temporal Serverçš„æŒä¹…åŒ–
- æ”¯æŒå¤šè¯­è¨€Workeräº’æ“ä½œ
- ä¼ä¸šçº§ç‰¹æ€§ï¼ˆæœç´¢ã€å¯è§æ€§ç­‰ï¼‰

---

## ğŸ”Œ ç»„ä»¶äº¤äº’è¯¦è§£

### WorkflowClient â†” WorkflowStorage

```rust
// Clientå¯åŠ¨å·¥ä½œæµ
impl WorkflowClient {
    pub async fn start_workflow<W: Workflow>(
        &self,
        workflow_id: WorkflowId,
        task_queue: String,
        input: W::Input,
        options: StartWorkflowOptions,
    ) -> Result<WorkflowHandle<W::Output>, ClientError> {
        // 1. åˆ›å»ºæ‰§è¡Œ
        let execution = WorkflowExecution {
            workflow_id,
            run_id: RunId(Uuid::new_v4()),
        };
        
        // 2. åˆ›å»ºStartedäº‹ä»¶
        let event = WorkflowEvent::WorkflowExecutionStarted {
            workflow_id: execution.workflow_id.clone(),
            workflow_type: W::name().to_string(),
            input: serde_json::to_value(&input)?,
            timestamp: Utc::now(),
            event_id: EventId(0),
        };
        
        let mut history = EventHistory::new();
        history.append(event);
        
        // 3. ä¿å­˜åˆ°å­˜å‚¨
        self.storage.save_workflow_execution(&execution, &history).await?;
        
        // 4. åˆ†å‘ä»»åŠ¡
        self.task_dispatcher.dispatch_workflow_task(WorkflowTask {
            workflow_execution: execution.clone(),
            workflow_type: W::name().to_string(),
            task_queue,
            input: serde_json::to_value(&input)?,
        }).await?;
        
        // 5. è¿”å›Handle
        Ok(WorkflowHandle::new(execution, self.storage.clone()))
    }
}
```

### WorkflowWorker â†” TaskPoller

```rust
// Workerè½®è¯¢ä»»åŠ¡
impl WorkflowWorker {
    async fn poll_workflow_tasks(&self) -> Result<(), WorkerError> {
        let semaphore = Arc::new(Semaphore::new(
            self.config.max_concurrent_workflow_executions
        ));
        
        loop {
            // 1. è·å–è®¸å¯
            let permit = semaphore.clone().acquire_owned().await?;
            
            // 2. è½®è¯¢ä»»åŠ¡
            match self.task_poller.poll_workflow_tasks().await {
                Ok(Some(task)) => {
                    let worker = self.clone();
                    tokio::spawn(async move {
                        let _permit = permit;
                        // 3. æ‰§è¡Œä»»åŠ¡
                        worker.execute_workflow_task(task).await.ok();
                    });
                }
                Ok(None) => {
                    tokio::time::sleep(Duration::from_millis(100)).await;
                }
                Err(e) => {
                    tracing::error!("Failed to poll workflow task: {}", e);
                }
            }
        }
    }
}
```

### WorkflowContext â†” EventHistory

```rust
// å·¥ä½œæµæ‰§è¡Œè®°å½•äº‹ä»¶
impl WorkflowContext {
    pub async fn execute_activity<A: Activity>(
        &self,
        input: A::Input,
        options: ActivityOptions,
    ) -> Result<A::Output, WorkflowError> {
        let activity_id = ActivityId(Uuid::new_v4().to_string());
        
        // 1. è®°å½•Scheduledäº‹ä»¶
        self.history.write().unwrap().append(
            WorkflowEvent::ActivityTaskScheduled {
                activity_id: activity_id.clone(),
                activity_type: A::name().to_string(),
                input: serde_json::to_value(&input)?,
                timestamp: Utc::now(),
                event_id: EventId(0),
            }
        );
        
        // 2. æ‰§è¡ŒActivity (é€šè¿‡Worker)
        let result = self.execute_activity_internal::<A>(
            activity_id.clone(),
            input,
            options
        ).await;
        
        // 3. è®°å½•å®Œæˆ/å¤±è´¥äº‹ä»¶
        match &result {
            Ok(output) => {
                self.history.write().unwrap().append(
                    WorkflowEvent::ActivityTaskCompleted {
                        activity_id,
                        result: serde_json::to_value(output)?,
                        timestamp: Utc::now(),
                        event_id: EventId(0),
                    }
                );
            }
            Err(error) => {
                self.history.write().unwrap().append(
                    WorkflowEvent::ActivityTaskFailed {
                        activity_id,
                        error: error.to_string(),
                        retry_count: 0,
                        timestamp: Utc::now(),
                        event_id: EventId(0),
                    }
                );
            }
        }
        
        result
    }
}
```

---

## ğŸ¯ è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆé€‰æ‹©åµŒå…¥å¼å­˜å‚¨æŠ½è±¡ï¼Ÿ

**åŸå› **:

- âœ… çµæ´»éƒ¨ç½²: æ”¯æŒå•æœºå’Œåˆ†å¸ƒå¼éƒ¨ç½²
- âœ… å¼€å‘å‹å¥½: æ— éœ€å¤–éƒ¨ä¾èµ–å³å¯å¼€å‘æµ‹è¯•
- âœ… æ€§èƒ½ä¼˜åŒ–: å¯é’ˆå¯¹ç‰¹å®šåœºæ™¯ä¼˜åŒ–å­˜å‚¨
- âœ… æ¸è¿›å¼è¿ç§»: å¯ä»åµŒå…¥å¼é€æ­¥è¿ç§»åˆ°Temporal Server

**æƒè¡¡**:

- âš ï¸ å®ç°å¤æ‚: éœ€è¦è‡ªå·±å®ç°å­˜å‚¨å±‚
- âš ï¸ è¿ç»´æˆæœ¬: éœ€è¦ç®¡ç†æ•°æ®åº“

### 2. ä¸ºä»€ä¹ˆä½¿ç”¨gRPCä¸Temporal Serveré€šä¿¡ï¼Ÿ

**åŸå› **:

- âœ… å®˜æ–¹åè®®: Temporalå®˜æ–¹ä½¿ç”¨gRPC
- âœ… æ€§èƒ½ä¼˜å¼‚: é«˜æ•ˆçš„äºŒè¿›åˆ¶åè®®
- âœ… ç±»å‹å®‰å…¨: Protocol Buffersæä¾›å¼ºç±»å‹
- âœ… è·¨è¯­è¨€: æ”¯æŒå¤šè¯­è¨€äº’æ“ä½œ

### 3. ä¸ºä»€ä¹ˆé€‰æ‹©Tokioä½œä¸ºå¼‚æ­¥è¿è¡Œæ—¶ï¼Ÿ

**åŸå› **:

- âœ… æˆç†Ÿç¨³å®š: Rustç”Ÿæ€æœ€æˆç†Ÿçš„å¼‚æ­¥è¿è¡Œæ—¶
- âœ… æ€§èƒ½ä¼˜å¼‚: é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿ
- âœ… ç”Ÿæ€ä¸°å¯Œ: å¤§é‡åº“æ”¯æŒ
- âœ… æ˜“äºä½¿ç”¨: è‰¯å¥½çš„APIè®¾è®¡

### 4. ä¸ºä»€ä¹ˆä½¿ç”¨traitæŠ½è±¡å­˜å‚¨å±‚ï¼Ÿ

**åŸå› **:

- âœ… å¯æµ‹è¯•: æ˜“äºmockå’Œå•å…ƒæµ‹è¯•
- âœ… å¯æ‰©å±•: æ”¯æŒå¤šç§å­˜å‚¨å®ç°
- âœ… è§£è€¦: SDKå±‚ä¸ä¾èµ–å…·ä½“å­˜å‚¨
- âœ… çµæ´»: å¯æ ¹æ®éœ€æ±‚é€‰æ‹©ä¸åŒå®ç°

---

## ğŸ“ˆ æ€§èƒ½è€ƒè™‘

### å†…å­˜ç®¡ç†

- **Arc/RwLock**: æœ€å°åŒ–é”ç«äº‰
- **äº‹ä»¶å†å²**: ä½¿ç”¨è¿½åŠ æ–¹å¼ï¼Œé¿å…å…¨é‡å¤åˆ¶
- **è¿æ¥æ± **: å¤ç”¨æ•°æ®åº“è¿æ¥

### å¹¶å‘æ§åˆ¶

```rust
pub struct WorkerConfig {
    /// æœ€å¤§å¹¶å‘å·¥ä½œæµæ‰§è¡Œæ•°
    pub max_concurrent_workflow_executions: usize,
    
    /// æœ€å¤§å¹¶å‘Activityæ‰§è¡Œæ•°
    pub max_concurrent_activity_executions: usize,
    
    /// è½®è¯¢é—´éš”
    pub poll_interval: Duration,
    
    /// ä»»åŠ¡é˜Ÿåˆ—å¤§å°
    pub task_queue_size: usize,
}
```

### æ‰¹å¤„ç†ä¼˜åŒ–

- äº‹ä»¶æ‰¹é‡å†™å…¥
- ä»»åŠ¡æ‰¹é‡è½®è¯¢
- è¿æ¥å¤ç”¨

---

## ğŸ” å®‰å…¨è€ƒè™‘

### è®¤è¯å’Œæˆæƒ

- gRPC TLSåŠ å¯†
- ä»¤ç‰Œè®¤è¯
- å·¥ä½œæµæƒé™æ§åˆ¶

### æ•°æ®ä¿æŠ¤

- æ•æ„Ÿæ•°æ®åŠ å¯†
- å®¡è®¡æ—¥å¿—
- æ•°æ®è®¿é—®æ§åˆ¶

---

## ğŸ“š ä¸‹ä¸€æ­¥

- **ç»§ç»­å­¦ä¹ **: [ç±»å‹ç³»ç»Ÿè®¾è®¡](./03_type_system.md)
- **æŸ¥çœ‹API**: [å·¥ä½œæµå®šä¹‰](./04_workflow_definition.md)
- **äº†è§£å®ç°**: [Workerå®ç°](./11_worker_implementation.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-10-26  
**ç»´æŠ¤è€…**: temporal-rust æ–‡æ¡£å›¢é˜Ÿ
